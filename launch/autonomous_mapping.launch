<launch>

    <!--
        This launch file spins up the node that creates the occupancy grid consumed by the planning subsystem. Note that it
        requires odometry (currently stereo odometry, but could be /ekf/Odometry/local) and rectified stereo images; these are
        provided by "stereo_odometry.launch" (which is launched automatically when this file is launched).
    -->

    <!-- switch to "true" for rviz -->
    <arg name="rviz" default="true" />
    <node if="$(arg rviz)" pkg="rviz" type="rviz" name="rviz" args="-d $(find rtabmap_ros)/launch/config/demo_stereo_outdoor.rviz"/>

    <!-- launch "stereo_odometry.launch" for odometry and rectified stereo images -->
    <include file="$(find core_rover)/launch/stereo_odometry.launch"/>

    <group ns="rtabmap">
        <node name="rtabmap" pkg="rtabmap_ros" type="rtabmap" output="screen" args="--delete_db_on_start">
            <param name="approx_sync" value="true"/>

            <!-- SUBSCRIBE to: odometry (either "/stereo_odometry" or "/ekf/Odometry/local") -->
            <remap from="odom" to="/stereo_odometry"/>

            <!-- SUBSCRIBE to: rectified stereo images -->
            <param name="subscribe_stereo" type="bool" value="true"/>
            <param name="subscribe_depth" type="bool" value="false"/> <!-- this is required for mono cameras -->
            <remap from="left/image_rect" to="/elp/left/image_rect_color"/> <!-- for some reason, left has to be RGB or mono-->
            <remap from="right/image_rect" to="/elp/right/image_rect"/>
            <remap from="left/camera_info" to="/elp/left/camera_info"/>
            <remap from="right/camera_info" to="/elp/right/camera_info"/>

            <!-- PUBLISH to: rtabmap occupancy grid -->

            <param name="frame_id" type="string" value="base_link"/>
        </node>
    </group>

</launch>
